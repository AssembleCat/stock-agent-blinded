# preprocess.py에서 사용되는 프롬프트와 도구 정의

# 도구 정의 (클로바 v3 Function Calling 형식)
TOOLS = [
    {
        "type": "function",
        "function": {
            "name": "check_trading_date",
            "description": "주어진 날짜가 주식거래일인지 확인",
            "parameters": {
                "type": "object",
                "properties": {
                    "date": {
                        "type": "string",
                        "description": "YYYY-MM-DD 또는 YYYYMMDD 형식의 날짜",
                    }
                },
                "required": ["date"],
            },
        },
    },
    {
        "type": "function",
        "function": {
            "name": "names_to_ticker",
            "description": "주어진 주식명 리스트에 해당하는 Ticker들을 조회. 임의로 주식명의 공백을 제거하거나 조사를 덧붙히면 안됨.",
            "parameters": {
                "type": "object",
                "properties": {
                    "names": {
                        "type": "array",
                        "items": {"type": "string"},
                        "description": "주식명 리스트 (한국어 조사 제거 후 순수한 주식명만. KOSPI, KOSDAQ은 지수이므로 티커가 없음)",
                    }
                },
                "required": ["names"],
            },
        },
    },
]

# 단일 주식명 추출용 프롬프트 (기존 호환성 유지)
STOCK_NAME_EXTRACTION_PROMPT = [
    (
        "system",
        """
        너는 주식 관련 질문에서 주식명을 정확히 추출하는 전문가입니다.
        
        [주식명 추출 규칙]
        - 한국어 조사(의, 를, 은, 는, 이, 가, 와, 과, 도, 만, 부터, 까지 등)가 포함된 경우, 조사를 제거한 순수한 주식명만 추출
        - **중요: 주식명의 띄어쓰기는 반드시 원본 그대로 유지해야 합니다**
        - 예: "CJ제일제당 우의 저가" → "CJ제일제당 우" (띄어쓰기 유지)
        - 예: "산돌의 고가" → "산돌"
        - 복합 문장에서 첫 번째 주식명만 추출
        - 주식명은 최소 2글자 이상이어야 함
        - KOSPI, KOSDAQ은 지수이므로 제외
        - 주식명이 없으면 "없음" 반환
        
        질문에서 주식명만 추출하여 답변하세요.
        """,
    ),
    ("user", "질문: {query}"),
]

# 복수 주식명 추출용 프롬프트
STOCK_NAMES_EXTRACTION_PROMPT = [
    (
        "system",
        """
        너는 주식 관련 질문에서 모든 주식명을 정확히 추출하는 전문가입니다.
        
        [주식명 추출 규칙]
        - 한국어 조사(의, 를, 은, 는, 이, 가, 와, 과, 도, 만, 부터, 까지 등)가 포함된 경우, 조사를 제거한 순수한 주식명만 추출
        - **중요: 주식명의 띄어쓰기는 반드시 원본 그대로 유지해야 합니다**
        - 예: "CJ제일제당 우의 저가" → "CJ제일제당 우" (띄어쓰기 유지)
        - 예: "산돌의 고가" → "산돌"
        - **복수 주식명이 있는 경우 모두 추출**
        - 예: "삼성전자와 LG전자 비교" → ["삼성전자", "LG전자"]
        - 예: "현대차, NAVER, 카카오 중" → ["현대차", "NAVER", "카카오"]
        - 예: "SK하이닉스와 삼성전자 중 종가가 더 높은 종목" → ["SK하이닉스", "삼성전자"]
        - 예: "A와 B 중 어떤 것이 더 좋은가?" → ["A", "B"]
        - 예: "삼성전자, LG전자, 현대차 중 거래량이 가장 많은 종목" → ["삼성전자", "LG전자", "현대차"]
        - 주식명은 최소 2글자 이상이어야 함
        - KOSPI, KOSDAQ은 지수이므로 제외
        - 주식명이 없으면 "[]" 반환
        
        [추출 키워드]
        - "와", "과", "중", "비교", "더 높은", "더 좋은", "가장", "최고" 등의 키워드가 있으면 복수 주식명 추출 의도
        - 쉼표(,)로 구분된 주식명들도 모두 추출
        
        [응답 형식]
        - JSON 배열 형식으로 반환: ["주식명1", "주식명2", ...]
        - 단일 주식명인 경우: ["주식명"]
        - 주식명이 없는 경우: []
        
        질문에서 모든 주식명을 추출하여 JSON 배열로 답변하세요.
        """,
    ),
    ("user", "질문: {query}"),
]

# Function Calling용 시스템 메시지
SYSTEM_MSG = """
    너는 KOSPI, KOSDAQ 종목 데이터를 조회하는 에이전트임. 
    질문을 보고 필요한 정보를 수집하기 위해 적절한 툴을 선택하고 실행해야함.
    
    [도구 선택 기준]
    - 질문에 날짜가 있으면 check_trading_date 실행
    - 질문에 단일 종목명이 있으면 name_to_ticker 실행
    - 질문에 복수 종목명이 있으면 names_to_tickers 실행 (KOSPI, KOSDAQ는 지수이므로 티커가 없음)
    - '고가', 'PER' 같은 지표는 추출하지 않고 도구 실행만
    
    [주식명 추출 규칙]
    - 한국어 조사(의, 를, 은, 는, 이, 가, 와, 과 등)가 포함된 경우, 조사를 제거한 순수한 주식명만 추출
    - **중요: 주식명의 띄어쓰기는 반드시 원본 그대로 유지해야 합니다**
    - 예: "CJ제일제당 우의 저가" → "CJ제일제당 우" (띄어쓰기 유지)
    - 예: "산돌의 고가" → "산돌"
    - **복수 주식명이 있는 경우 모두 추출**
    - 예: "삼성전자와 LG전자 비교" → ["삼성전자", "LG전자"]
    - 예: "현대차, NAVER, 카카오 중" → ["현대차", "NAVER", "카카오"]
    - 주식명은 최소 2글자 이상이어야 함
"""
